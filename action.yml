name: 'lvCICD'
author: 'LV-APT'
description: 'CICD Action used for LabVIEW Users'
branding:
  icon: 'tool'
  color: 'green'

inputs:
  Operation:
    description: 'The operation of lvCICD'
    required: false
    default: 'lvecho'
  Parameter1:
    description: 'Parameter1 of lvCICD'
    required: false
    default: ''
  Parameter2:
    description: 'Parameter2 of lvCICD'
    required: false
    default: ''
  Parameter3:
    description: 'Parameter3 of lvCICD'
    required: false
    default: ''
  Parameter4:
    description: 'Parameter4 of lvCICD'
    required: false
    default: ''
  Parameter5:
    description: 'Parameter5 of lvCICD'
    required: false
    default: ''
  lvCICD:
    description: 'CommandLine'
    required: false
    default: LabVIEWCLI -OperationName RunVI -VIPath ".\lvapt-CICD.vi"
  LabVIEW_Version:
    description: 'LabVIEW Version Used'
    required: false
    default: "2019"

runs:
  using: "composite"

  steps:
    - name: "Checkout lvCICD Action"
      uses: actions/checkout@v2.4.2

    # - name: "Set lvCICD Script Env Variable"
    #   run:
    #     ${{ github.action_path }}\SetGithubEnvVariable.ps1 lvCICD abcdef
    #   shell: powershell

    # - name: "Show working dir"
    #   run: pwd
    #   shell: powershell

    # - id: get_vi_server_port_number
    #   run:
    #     echo "::set-output name=PortNum::"
    #   shell: powershell

#  echo "{lvCICD}={LabVIEWCLI -OperationName RunVI -VIPath "${{ github.action_path }}\lvapt-CICD.vi" -LabVIEWPath "C:\Program Files (x86)\National Instruments\LabVIEW 2019\LabVIEW.exe" -PortNumber 3364}" >> $GITHUB_ENV
    # - name: "Test Environment"
    #   run: ${{ inputs.lvCICD }} -LabVIEWPath "C:\Program Files (x86)\National Instruments\LabVIEW ${{ inputs.LabVIEW_Version }}\LabVIEW.exe" -PortNumber ${{ steps.generate_number.outputs.PortNum }} lvEcho "line1" "line2" "line3"
    #   shell: powershell

    - name: "Run Scripts"
      run:
        $PortNum = ${{ github.action_path }}\ViServerPort.ps1
        ${{ inputs.lvCICD }} -LabVIEWPath "C:\Program Files (x86)\National Instruments\LabVIEW ${{ inputs.LabVIEW_Version }}\LabVIEW.exe" -PortNumber $PortNum ${{ inputs.Operation }} ${{ inputs.Parameter1 }} ${{ inputs.Parameter2 }} ${{ inputs.Parameter3}} ${{ inputs.Parameter4}} ${{ inputs.Parameter5}}
      shell: powershell